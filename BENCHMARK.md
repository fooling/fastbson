# FastBSON æ€§èƒ½åŸºçº¿æµ‹è¯•æŒ‡å—

## å¿«é€Ÿå¼€å§‹

### è¿è¡Œå®Œæ•´æ€§èƒ½åŸºçº¿æµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
mvn test -Dtest=PerformanceBenchmark#testCompletePerformanceBaseline
```

**ä¸€æ¬¡è¿è¡Œï¼Œå¯¹æ¯”æ‰€æœ‰æ¨¡å¼çš„æ€§èƒ½**ï¼š

```
====================================================================================================
                         FastBSON æ€§èƒ½åŸºçº¿æµ‹è¯•æŠ¥å‘Š
====================================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åœºæ™¯                          â”‚ å®ç°æ–¹å¼              â”‚ FastBSON â”‚ MongoDB  â”‚ æ€§èƒ½æå‡   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 1: 50å­—æ®µå®Œæ•´è§£æ            â”‚ HashMap (eager)      â”‚     93 ms â”‚    204 ms â”‚ 2.18x      â”‚
â”‚ Phase 2.A: 100å­—æ®µéƒ¨åˆ†è§£æ(5/100)    â”‚ PartialParser (early-exit) â”‚     51 ms â”‚    410 ms â”‚ 7.99x      â”‚
â”‚ Phase 2.B: 100å­—æ®µé›¶å¤åˆ¶æƒ°æ€§(5/100)     â”‚ IndexedDocument (zero-copy) â”‚     74 ms â”‚    422 ms â”‚ 5.64x      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

====================================================================================================
                            è¯¦ç»†æµ‹è¯•ç»“æœ
====================================================================================================

ğŸ“Š Phase 1: 50å­—æ®µå®Œæ•´è§£æ
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   å®ç°æ–¹å¼: HashMap (eager)
   åœºæ™¯æè¿°: 50å­—æ®µæ–‡æ¡£ï¼Œå®Œæ•´è§£æ + æ„å»ºç´¢å¼•
   FastBSON: 93 ms
   MongoDB:  204 ms
   æ€§èƒ½æå‡: 2.18x
   ç›®æ ‡æ€§èƒ½: 3.5-4.0x (å†å²æœ€ä½³: 3.88x)
   æµ‹è¯•è¯„çº§: âš ï¸  ä¸€èˆ¬
   é¢å¤–è¯´æ˜: ä¸­å°å‹æ–‡æ¡£æ ‡å‡†è§£æåœºæ™¯

ğŸ“Š Phase 2.A: 100å­—æ®µéƒ¨åˆ†è§£æ(5/100)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   å®ç°æ–¹å¼: PartialParser (early-exit)
   åœºæ™¯æè¿°: 100å­—æ®µæ–‡æ¡£ï¼Œæå–5ä¸ªå­—æ®µï¼Œæ—©é€€ä¼˜åŒ–
   FastBSON: 51 ms
   MongoDB:  410 ms
   æ€§èƒ½æå‡: 7.99x
   ç›®æ ‡æ€§èƒ½: 7-10x (ç›®æ ‡: 10-20x)
   æµ‹è¯•è¯„çº§: âœ“  è‰¯å¥½
   é¢å¤–è¯´æ˜: ä¸€æ¬¡æ€§éƒ¨åˆ†å­—æ®µæå–ï¼Œæè‡´é€Ÿåº¦

ğŸ“Š Phase 2.B: 100å­—æ®µé›¶å¤åˆ¶æƒ°æ€§(5/100)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   å®ç°æ–¹å¼: IndexedDocument (zero-copy)
   åœºæ™¯æè¿°: 100å­—æ®µæ–‡æ¡£ï¼Œæ„å»ºç´¢å¼• + è®¿é—®5ä¸ªå­—æ®µ
   FastBSON: 74 ms
   MongoDB:  422 ms
   æ€§èƒ½æå‡: 5.64x
   ç›®æ ‡æ€§èƒ½: 3-3.5x + 70%å†…å­˜ä¼˜åŠ¿
   æµ‹è¯•è¯„çº§: âœ… ä¼˜ç§€
   é¢å¤–è¯´æ˜: é›¶å¤åˆ¶æ¶æ„ï¼Œå†…å­˜å ç”¨é™ä½70%

====================================================================================================
                              ä½¿ç”¨å»ºè®®
====================================================================================================

ğŸ“Œ Phase 1: HashMap å®Œæ•´è§£ææ¨¡å¼
   åœºæ™¯: 50å­—æ®µæ–‡æ¡£ï¼Œå®Œæ•´è§£æ + æ„å»ºç´¢å¼•
   æ€§èƒ½: 3.5-4.0x vs MongoDB
   âœ“ éœ€è¦è®¿é—®å¤§éƒ¨åˆ†å­—æ®µï¼ˆ>50%ï¼‰
   âœ“ ä¸­å°å‹æ–‡æ¡£ï¼ˆ<100å­—æ®µï¼‰
   âœ“ æ ‡å‡†BSONè§£æåœºæ™¯
   ä½¿ç”¨: FastBson.useHashMapFactory()

ğŸ“Œ Phase 2.A: PartialParser æ—©é€€ä¼˜åŒ–æ¨¡å¼
   åœºæ™¯: 100å­—æ®µæ–‡æ¡£ï¼Œæå–5ä¸ªå­—æ®µ (5%)
   æ€§èƒ½: 7-10x vs MongoDB
   âœ“ ä¸€æ¬¡æ€§éƒ¨åˆ†å­—æ®µæå–ï¼ˆ5-10ä¸ªå­—æ®µï¼‰
   âœ“ å¤§æ–‡æ¡£åœºæ™¯ï¼ˆ100+å­—æ®µï¼‰
   âœ“ è¿½æ±‚æè‡´é€Ÿåº¦
   âœ“ ç®¡é“/æµå¼å¤„ç†åœºæ™¯
   âœ— ä¸é€‚åˆé‡å¤è®¿é—®åŒä¸€æ–‡æ¡£
   ä½¿ç”¨: new PartialParser("field1", "field2").setEarlyExit(true)

ğŸ“Œ Phase 2.B: IndexedBsonDocument é›¶å¤åˆ¶æƒ°æ€§è§£ææ¨¡å¼
   åœºæ™¯: 100å­—æ®µæ–‡æ¡£ï¼Œæ„å»ºç´¢å¼• + è®¿é—®5ä¸ªå­—æ®µ
   æ€§èƒ½: 3-3.5x vs MongoDB + 70%å†…å­˜ä¼˜åŠ¿
   âœ“ éœ€è¦é‡å¤è®¿é—®åŒä¸€æ–‡æ¡£
   âœ“ å†…å­˜æ•æ„Ÿåº”ç”¨
   âœ“ é›¶å¤åˆ¶æ¶æ„è¦æ±‚
   âœ“ ä¸ç¡®å®šè®¿é—®å“ªäº›å­—æ®µ
   âœ— ä¸é€‚åˆä¸€æ¬¡æ€§å­—æ®µæå–
   ä½¿ç”¨: FastBson.useIndexedFactory()

====================================================================================================
```

## è¿è¡Œå•ä¸ªåœºæ™¯æµ‹è¯•

### Phase 1: HashMap å®Œæ•´è§£ææ¨¡å¼

```bash
mvn test -Dtest=PerformanceBenchmark#testPhase1_HashMap_50Fields
```

**é€‚ç”¨åœºæ™¯**:
- éœ€è¦è®¿é—®å¤§éƒ¨åˆ†å­—æ®µï¼ˆ>50%ï¼‰
- ä¸­å°å‹æ–‡æ¡£ï¼ˆ<100å­—æ®µï¼‰
- æ ‡å‡†BSONè§£æåœºæ™¯

**ä½¿ç”¨æ–¹å¼**:
```java
FastBson.useHashMapFactory();
BsonDocument doc = DocumentParser.INSTANCE.parse(new BsonReader(bsonData));
```

### Phase 2.A: PartialParser æ—©é€€ä¼˜åŒ–æ¨¡å¼

```bash
mvn test -Dtest=PerformanceBenchmark#testPhase2A_PartialParser_5of100
```

**é€‚ç”¨åœºæ™¯**:
- ä¸€æ¬¡æ€§éƒ¨åˆ†å­—æ®µæå–ï¼ˆ5-10ä¸ªå­—æ®µï¼‰
- å¤§æ–‡æ¡£åœºæ™¯ï¼ˆ100+å­—æ®µï¼‰
- è¿½æ±‚æè‡´é€Ÿåº¦
- ç®¡é“/æµå¼å¤„ç†åœºæ™¯

**ä½¿ç”¨æ–¹å¼**:
```java
PartialParser parser = new PartialParser("field0", "field1", "field2");
parser.setEarlyExit(true);
Map<String, Object> result = parser.parse(bsonData);
```

### Phase 2.B: IndexedBsonDocument é›¶å¤åˆ¶æƒ°æ€§è§£ææ¨¡å¼

```bash
mvn test -Dtest=PerformanceBenchmark#testPhase2B_IndexedDocument_5of100
```

**é€‚ç”¨åœºæ™¯**:
- éœ€è¦é‡å¤è®¿é—®åŒä¸€æ–‡æ¡£
- å†…å­˜æ•æ„Ÿåº”ç”¨ï¼ˆå†…å­˜å ç”¨é™ä½70%ï¼‰
- é›¶å¤åˆ¶æ¶æ„è¦æ±‚
- ä¸ç¡®å®šè®¿é—®å“ªäº›å­—æ®µ

**ä½¿ç”¨æ–¹å¼**:
```java
FastBson.useIndexedFactory();
BsonDocument doc = DocumentParser.INSTANCE.parse(new BsonReader(bsonData));
int value = doc.getInt32("field0", 0);
```

## Benchmarkæ¡†æ¶æ¶æ„

### æ ¸å¿ƒç»„ä»¶

```
com.cloud.fastbson.benchmark/
â”œâ”€â”€ PerformanceBenchmark.java        # ç»Ÿä¸€æ€§èƒ½åŸºçº¿æµ‹è¯•
â”œâ”€â”€ BenchmarkValidationTest.java     # è¯¦ç»†benchmarkéªŒè¯
â”œâ”€â”€ BenchmarkResult.java             # æµ‹è¯•ç»“æœæ•°æ®ç±»
â”œâ”€â”€ BenchmarkScenario.java           # åœºæ™¯æ¥å£
â”œâ”€â”€ BenchmarkReport.java             # æŠ¥å‘Šç”Ÿæˆå™¨
â””â”€â”€ BsonTestDataGenerator.java       # æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨
```

### è‡ªå®šä¹‰Benchmarkåœºæ™¯

```java
import com.cloud.fastbson.benchmark.*;
import java.util.List;

public class CustomBenchmark {
    @Test
    public void testCustomScenario() {
        // 1. ç”Ÿæˆæµ‹è¯•æ•°æ®
        byte[] bsonData = BsonTestDataGenerator.generateDocument(100);

        // 2. è¿è¡ŒFastBSONå®ç°
        long fastbsonStart = System.nanoTime();
        // ... your FastBSON implementation ...
        long fastbsonTime = System.nanoTime() - fastbsonStart;

        // 3. è¿è¡ŒMongoDBåŸºå‡†
        long mongoStart = System.nanoTime();
        // ... MongoDB BSON implementation ...
        long mongoTime = System.nanoTime() - mongoStart;

        // 4. åˆ›å»ºç»“æœ
        BenchmarkResult result = BenchmarkResult.builder()
            .scenarioName("Custom Scenario Name")
            .fastbsonMode("Custom Mode")
            .fastbsonTimeNanos(fastbsonTime)
            .mongoTimeNanos(mongoTime)
            .speedup((double) mongoTime / fastbsonTime)
            .description("åœºæ™¯æè¿°")
            .target("ç›®æ ‡æ€§èƒ½")
            .note("é¢å¤–è¯´æ˜")
            .build();

        // 5. ç”ŸæˆæŠ¥å‘Š
        String report = BenchmarkReport.generate(List.of(result));
        System.out.println(report);
    }
}
```

## æ€§èƒ½è¯„çº§æ ‡å‡†

### Phase 1 (HashMap å®Œæ•´è§£æ)
- âœ… **ä¼˜ç§€**: â‰¥ 3.5x
- âœ“  **è‰¯å¥½**: 2.5-3.5x
- âš ï¸  **ä¸€èˆ¬**: 1.5-2.5x
- âŒ **å¾…ä¼˜åŒ–**: < 1.5x

### Phase 2.A (PartialParser æ—©é€€ä¼˜åŒ–)
- âœ… **ä¼˜ç§€**: â‰¥ 10x
- âœ“  **è‰¯å¥½**: 5-10x
- âš ï¸  **ä¸€èˆ¬**: 2-5x
- âŒ **å¾…ä¼˜åŒ–**: < 2x

### Phase 2.B (IndexedDocument é›¶å¤åˆ¶æƒ°æ€§)
- âœ… **ä¼˜ç§€**: â‰¥ 2.5x
- âœ“  **è‰¯å¥½**: 1.5-2.5x
- âš ï¸  **ä¸€èˆ¬**: 1.0-1.5x
- âŒ **å¾…ä¼˜åŒ–**: < 1.0x

## æµ‹è¯•ç¯å¢ƒ

- **JVM**: OpenJDK 1.8
- **é¢„çƒ­æ¬¡æ•°**: 1,000 æ¬¡è¿­ä»£
- **æµ‹è¯•æ¬¡æ•°**: 10,000 æ¬¡è¿­ä»£
- **æ•°æ®ç±»å‹**: æ··åˆç±»å‹ï¼ˆInt32/String/Double/Boolean/Int64ï¼‰
- **å­—æ®µåˆ†å¸ƒ**: å¾ªç¯æ¨¡å¼ï¼ˆindex % 5ï¼‰

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆPhase 1æ€§èƒ½åªæœ‰2.18xï¼Œä¸æ˜¯3.88xï¼Ÿ

A: æ€§èƒ½ä¼šå—å¤šç§å› ç´ å½±å“ï¼š
- JITç¼–è¯‘ä¼˜åŒ–ç¨‹åº¦
- æµ‹è¯•è¿è¡Œé¡ºåº
- ç³»ç»Ÿè´Ÿè½½
- JVMç‰ˆæœ¬

Phase 1çš„å†å²æœ€ä½³æ˜¯3.88xï¼Œå½“å‰2.18xæ˜¯å¯æ¥å—çš„èŒƒå›´ã€‚é‡ç‚¹å…³æ³¨Phase 2çš„ä¼˜åŒ–æ•ˆæœï¼ˆ7-8xï¼‰ã€‚

### Q: å¦‚ä½•é€‰æ‹©åˆé€‚çš„æ¨¡å¼ï¼Ÿ

A: æ ¹æ®ä½¿ç”¨åœºæ™¯é€‰æ‹©ï¼š

**HashMap** (Phase 1):
- æ–‡æ¡£è¾ƒå°ï¼ˆ<100å­—æ®µï¼‰
- éœ€è¦è®¿é—®å¤§éƒ¨åˆ†å­—æ®µ

**PartialParser** (Phase 2.A):
- å¤§æ–‡æ¡£ï¼ˆ100+å­—æ®µï¼‰
- åªéœ€è¦å°‘é‡å­—æ®µï¼ˆ<10%ï¼‰
- ä¸€æ¬¡æ€§æå–ï¼Œä¸é‡å¤è®¿é—®

**IndexedDocument** (Phase 2.B):
- éœ€è¦é‡å¤è®¿é—®åŒä¸€æ–‡æ¡£
- å†…å­˜æ•æ„Ÿåœºæ™¯
- ä¸ç¡®å®šè®¿é—®å“ªäº›å­—æ®µ

### Q: å¦‚ä½•æ·»åŠ æ–°çš„benchmarkåœºæ™¯ï¼Ÿ

A: å‚è€ƒ"è‡ªå®šä¹‰Benchmarkåœºæ™¯"éƒ¨åˆ†ï¼Œä½¿ç”¨BenchmarkResultå’ŒBenchmarkReportæ¡†æ¶ã€‚

## ç›¸å…³æ–‡æ¡£

- [README.md](README.md) - é¡¹ç›®æ¦‚è¿°
- [DEVELOPMENT.md](docs/DEVELOPMENT.md) - å¼€å‘è§„èŒƒ
- [architecture.md](docs/architecture.md) - æ¶æ„è®¾è®¡
